{
    "id": "4393776420",
    "type": "PullRequestReviewCommentEvent",
    "actor": {
      "id": 932968,
      "login": "juanignaciosl",
      "display_login": "juanignaciosl",
      "gravatar_id": "",
      "url": "https://api.github.com/users/juanignaciosl",
      "avatar_url": "https://avatars.githubusercontent.com/u/932968?"
    },
    "repo": {
      "id": 4909355,
      "name": "CartoDB/cartodb",
      "url": "https://api.github.com/repos/CartoDB/cartodb"
    },
    "payload": {
      "action": "created",
      "comment": {
        "url": "https://api.github.com/repos/CartoDB/cartodb/pulls/comments/74093342",
        "id": 74093342,
        "diff_hunk": "@@ -0,0 +1,19 @@\n+module Carto\n+  module Api\n+    class StatePresenter\n+      def initialize(state)\n+        @state = state\n+      end\n+\n+      def to_hash",
        "path": "app/controllers/carto/api/state_presenter.rb",
        "position": 8,
        "original_position": 8,
        "commit_id": "1921e7557180608528274dfca31ce6ef967f00ca",
        "original_commit_id": "1921e7557180608528274dfca31ce6ef967f00ca",
        "user": {
          "login": "juanignaciosl",
          "id": 932968,
          "avatar_url": "https://avatars.githubusercontent.com/u/932968?v=3",
          "gravatar_id": "",
          "url": "https://api.github.com/users/juanignaciosl",
          "html_url": "https://github.com/juanignaciosl",
          "followers_url": "https://api.github.com/users/juanignaciosl/followers",
          "following_url": "https://api.github.com/users/juanignaciosl/following{/other_user}",
          "gists_url": "https://api.github.com/users/juanignaciosl/gists{/gist_id}",
          "starred_url": "https://api.github.com/users/juanignaciosl/starred{/owner}{/repo}",
          "subscriptions_url": "https://api.github.com/users/juanignaciosl/subscriptions",
          "organizations_url": "https://api.github.com/users/juanignaciosl/orgs",
          "repos_url": "https://api.github.com/users/juanignaciosl/repos",
          "events_url": "https://api.github.com/users/juanignaciosl/events{/privacy}",
          "received_events_url": "https://api.github.com/users/juanignaciosl/received_events",
          "type": "User",
          "site_admin": false
        },
        "body": "Are we renaming `to_poro` to `to_hash`? ðŸ˜… ",
        "created_at": "2016-08-09T16:26:56Z",
        "updated_at": "2016-08-09T16:26:56Z",
        "html_url": "https://github.com/CartoDB/cartodb/pull/9374#discussion_r74093342",
        "pull_request_url": "https://api.github.com/repos/CartoDB/cartodb/pulls/9374",
        "_links": {
          "self": {
            "href": "https://api.github.com/repos/CartoDB/cartodb/pulls/comments/74093342"
          },
          "html": {
            "href": "https://github.com/CartoDB/cartodb/pull/9374#discussion_r74093342"
          },
          "pull_request": {
            "href": "https://api.github.com/repos/CartoDB/cartodb/pulls/9374"
          }
        }
      },
      "pull_request": {
        "url": "https://api.github.com/repos/CartoDB/cartodb/pulls/9374",
        "id": 80612442,
        "html_url": "https://github.com/CartoDB/cartodb/pull/9374",
        "diff_url": "https://github.com/CartoDB/cartodb/pull/9374.diff",
        "patch_url": "https://github.com/CartoDB/cartodb/pull/9374.patch",
        "issue_url": "https://api.github.com/repos/CartoDB/cartodb/issues/9374",
        "number": 9374,
        "state": "open",
        "locked": false,
        "title": "State",
        "user": {
          "login": "gfiorav",
          "id": 4222826,
          "avatar_url": "https://avatars.githubusercontent.com/u/4222826?v=3",
          "gravatar_id": "",
          "url": "https://api.github.com/users/gfiorav",
          "html_url": "https://github.com/gfiorav",
          "followers_url": "https://api.github.com/users/gfiorav/followers",
          "following_url": "https://api.github.com/users/gfiorav/following{/other_user}",
          "gists_url": "https://api.github.com/users/gfiorav/gists{/gist_id}",
          "starred_url": "https://api.github.com/users/gfiorav/starred{/owner}{/repo}",
          "subscriptions_url": "https://api.github.com/users/gfiorav/subscriptions",
          "organizations_url": "https://api.github.com/users/gfiorav/orgs",
          "repos_url": "https://api.github.com/users/gfiorav/repos",
          "events_url": "https://api.github.com/users/gfiorav/events{/privacy}",
          "received_events_url": "https://api.github.com/users/gfiorav/received_events",
          "type": "User",
          "site_admin": false
        },
        "body": "Fixes #8463\r\nFixes #8464\r\n\r\n# Synopsis\r\n\r\nThis makes state (which had already been seen at deep insights level) a standard trade coin for visualisations in the back end. There is now a State model, whose spirit is to capture the current state of a given visualisation (its widget's filters and viewport ATM). \r\n\r\nFor example, if you apply a filter in a widget and refresh the builder view, the same applied state will be reloaded into the the deep insights dashboard (so everything is exactly how you left it). In addition, when the vis is shared, any state will be applied in the embed as you left it or map capped it.\r\n\r\nState is exportable as well.\r\n\r\n## State model\r\n\r\n```ruby\r\nUuid     :id, primary_key: true, default: 'uuid_generate_v4()'.lit\r\nDateTime :created_at, default: Sequel::CURRENT_TIMESTAMP\r\nDateTime :updated_at, default: Sequel::CURRENT_TIMESTAMP\r\nString   :json, null: false, type: 'json'\r\n\r\nforeign_key :user_id, :users, type: :uuid, null: false, on_delete: :cascade\r\nforeign_key :visualization_id, :visualizations, type: :uuid, null: false, on_delete: :cascade\r\n\r\nadd_index [:user_id, :visualization_id]\r\n```\r\n\r\nThis model is associated to a vis and a user (see snapshots feature design in consideration). In this implementation, there is one, global, state for evert vis that can only be updated (`.../vis/:id/state`). Updates are triggered by viewport or widget changes.\r\n\r\n## Considerations\r\n\r\nIt should be considered that this same model will be reused for upcoming snapshots feature, by which different users will be able to save different embed states and interact with them (like 10 per user/vis). Although it will use the same model, it will be an entirely different endpoint (a normal CRUD).\r\n\r\nPlease review the front end @xavijam \r\nPlease review the back end @javitonino and @juanignaciosl (in that order, I expect a lot of design comments.",
        "created_at": "2016-08-09T12:37:45Z",
        "updated_at": "2016-08-09T16:26:56Z",
        "closed_at": null,
        "merged_at": null,
        "merge_commit_sha": "7b423e938404e7963a2635bba76c256073feddf8",
        "assignee": null,
        "assignees": [

        ],
        "milestone": null,
        "commits_url": "https://api.github.com/repos/CartoDB/cartodb/pulls/9374/commits",
        "review_comments_url": "https://api.github.com/repos/CartoDB/cartodb/pulls/9374/comments",
        "review_comment_url": "https://api.github.com/repos/CartoDB/cartodb/pulls/comments{/number}",
        "comments_url": "https://api.github.com/repos/CartoDB/cartodb/issues/9374/comments",
        "statuses_url": "https://api.github.com/repos/CartoDB/cartodb/statuses/1921e7557180608528274dfca31ce6ef967f00ca",
        "head": {
          "label": "CartoDB:state",
          "ref": "state",
          "sha": "1921e7557180608528274dfca31ce6ef967f00ca",
          "user": {
            "login": "CartoDB",
            "id": 1799254,
            "avatar_url": "https://avatars.githubusercontent.com/u/1799254?v=3",
            "gravatar_id": "",
            "url": "https://api.github.com/users/CartoDB",
            "html_url": "https://github.com/CartoDB",
            "followers_url": "https://api.github.com/users/CartoDB/followers",
            "following_url": "https://api.github.com/users/CartoDB/following{/other_user}",
            "gists_url": "https://api.github.com/users/CartoDB/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/CartoDB/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/CartoDB/subscriptions",
            "organizations_url": "https://api.github.com/users/CartoDB/orgs",
            "repos_url": "https://api.github.com/users/CartoDB/repos",
            "events_url": "https://api.github.com/users/CartoDB/events{/privacy}",
            "received_events_url": "https://api.github.com/users/CartoDB/received_events",
            "type": "Organization",
            "site_admin": false
          },
          "repo": {
            "id": 4909355,
            "name": "cartodb",
            "full_name": "CartoDB/cartodb",
            "owner": {
              "login": "CartoDB",
              "id": 1799254,
              "avatar_url": "https://avatars.githubusercontent.com/u/1799254?v=3",
              "gravatar_id": "",
              "url": "https://api.github.com/users/CartoDB",
              "html_url": "https://github.com/CartoDB",
              "followers_url": "https://api.github.com/users/CartoDB/followers",
              "following_url": "https://api.github.com/users/CartoDB/following{/other_user}",
              "gists_url": "https://api.github.com/users/CartoDB/gists{/gist_id}",
              "starred_url": "https://api.github.com/users/CartoDB/starred{/owner}{/repo}",
              "subscriptions_url": "https://api.github.com/users/CartoDB/subscriptions",
              "organizations_url": "https://api.github.com/users/CartoDB/orgs",
              "repos_url": "https://api.github.com/users/CartoDB/repos",
              "events_url": "https://api.github.com/users/CartoDB/events{/privacy}",
              "received_events_url": "https://api.github.com/users/CartoDB/received_events",
              "type": "Organization",
              "site_admin": false
            },
            "private": false,
            "html_url": "https://github.com/CartoDB/cartodb",
            "description": "Location Intelligence & Data Visualization tool",
            "fork": false,
            "url": "https://api.github.com/repos/CartoDB/cartodb",
            "forks_url": "https://api.github.com/repos/CartoDB/cartodb/forks",
            "keys_url": "https://api.github.com/repos/CartoDB/cartodb/keys{/key_id}",
            "collaborators_url": "https://api.github.com/repos/CartoDB/cartodb/collaborators{/collaborator}",
            "teams_url": "https://api.github.com/repos/CartoDB/cartodb/teams",
            "hooks_url": "https://api.github.com/repos/CartoDB/cartodb/hooks",
            "issue_events_url": "https://api.github.com/repos/CartoDB/cartodb/issues/events{/number}",
            "events_url": "https://api.github.com/repos/CartoDB/cartodb/events",
            "assignees_url": "https://api.github.com/repos/CartoDB/cartodb/assignees{/user}",
            "branches_url": "https://api.github.com/repos/CartoDB/cartodb/branches{/branch}",
            "tags_url": "https://api.github.com/repos/CartoDB/cartodb/tags",
            "blobs_url": "https://api.github.com/repos/CartoDB/cartodb/git/blobs{/sha}",
            "git_tags_url": "https://api.github.com/repos/CartoDB/cartodb/git/tags{/sha}",
            "git_refs_url": "https://api.github.com/repos/CartoDB/cartodb/git/refs{/sha}",
            "trees_url": "https://api.github.com/repos/CartoDB/cartodb/git/trees{/sha}",
            "statuses_url": "https://api.github.com/repos/CartoDB/cartodb/statuses/{sha}",
            "languages_url": "https://api.github.com/repos/CartoDB/cartodb/languages",
            "stargazers_url": "https://api.github.com/repos/CartoDB/cartodb/stargazers",
            "contributors_url": "https://api.github.com/repos/CartoDB/cartodb/contributors",
            "subscribers_url": "https://api.github.com/repos/CartoDB/cartodb/subscribers",
            "subscription_url": "https://api.github.com/repos/CartoDB/cartodb/subscription",
            "commits_url": "https://api.github.com/repos/CartoDB/cartodb/commits{/sha}",
            "git_commits_url": "https://api.github.com/repos/CartoDB/cartodb/git/commits{/sha}",
            "comments_url": "https://api.github.com/repos/CartoDB/cartodb/comments{/number}",
            "issue_comment_url": "https://api.github.com/repos/CartoDB/cartodb/issues/comments{/number}",
            "contents_url": "https://api.github.com/repos/CartoDB/cartodb/contents/{+path}",
            "compare_url": "https://api.github.com/repos/CartoDB/cartodb/compare/{base}...{head}",
            "merges_url": "https://api.github.com/repos/CartoDB/cartodb/merges",
            "archive_url": "https://api.github.com/repos/CartoDB/cartodb/{archive_format}{/ref}",
            "downloads_url": "https://api.github.com/repos/CartoDB/cartodb/downloads",
            "issues_url": "https://api.github.com/repos/CartoDB/cartodb/issues{/number}",
            "pulls_url": "https://api.github.com/repos/CartoDB/cartodb/pulls{/number}",
            "milestones_url": "https://api.github.com/repos/CartoDB/cartodb/milestones{/number}",
            "notifications_url": "https://api.github.com/repos/CartoDB/cartodb/notifications{?since,all,participating}",
            "labels_url": "https://api.github.com/repos/CartoDB/cartodb/labels{/name}",
            "releases_url": "https://api.github.com/repos/CartoDB/cartodb/releases{/id}",
            "deployments_url": "https://api.github.com/repos/CartoDB/cartodb/deployments",
            "created_at": "2012-07-05T15:23:45Z",
            "updated_at": "2016-08-08T21:52:25Z",
            "pushed_at": "2016-08-09T15:44:07Z",
            "git_url": "git://github.com/CartoDB/cartodb.git",
            "ssh_url": "git@github.com:CartoDB/cartodb.git",
            "clone_url": "https://github.com/CartoDB/cartodb.git",
            "svn_url": "https://github.com/CartoDB/cartodb",
            "homepage": "http://carto.com",
            "size": 398205,
            "stargazers_count": 1220,
            "watchers_count": 1220,
            "language": "HTML",
            "has_issues": true,
            "has_downloads": true,
            "has_wiki": true,
            "has_pages": false,
            "forks_count": 308,
            "mirror_url": null,
            "open_issues_count": 1067,
            "forks": 308,
            "open_issues": 1067,
            "watchers": 1220,
            "default_branch": "master"
          }
        },
        "base": {
          "label": "CartoDB:master",
          "ref": "master",
          "sha": "b1ae1625748bbbb08961d1c90a516eddcf377f47",
          "user": {
            "login": "CartoDB",
            "id": 1799254,
            "avatar_url": "https://avatars.githubusercontent.com/u/1799254?v=3",
            "gravatar_id": "",
            "url": "https://api.github.com/users/CartoDB",
            "html_url": "https://github.com/CartoDB",
            "followers_url": "https://api.github.com/users/CartoDB/followers",
            "following_url": "https://api.github.com/users/CartoDB/following{/other_user}",
            "gists_url": "https://api.github.com/users/CartoDB/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/CartoDB/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/CartoDB/subscriptions",
            "organizations_url": "https://api.github.com/users/CartoDB/orgs",
            "repos_url": "https://api.github.com/users/CartoDB/repos",
            "events_url": "https://api.github.com/users/CartoDB/events{/privacy}",
            "received_events_url": "https://api.github.com/users/CartoDB/received_events",
            "type": "Organization",
            "site_admin": false
          },
          "repo": {
            "id": 4909355,
            "name": "cartodb",
            "full_name": "CartoDB/cartodb",
            "owner": {
              "login": "CartoDB",
              "id": 1799254,
              "avatar_url": "https://avatars.githubusercontent.com/u/1799254?v=3",
              "gravatar_id": "",
              "url": "https://api.github.com/users/CartoDB",
              "html_url": "https://github.com/CartoDB",
              "followers_url": "https://api.github.com/users/CartoDB/followers",
              "following_url": "https://api.github.com/users/CartoDB/following{/other_user}",
              "gists_url": "https://api.github.com/users/CartoDB/gists{/gist_id}",
              "starred_url": "https://api.github.com/users/CartoDB/starred{/owner}{/repo}",
              "subscriptions_url": "https://api.github.com/users/CartoDB/subscriptions",
              "organizations_url": "https://api.github.com/users/CartoDB/orgs",
              "repos_url": "https://api.github.com/users/CartoDB/repos",
              "events_url": "https://api.github.com/users/CartoDB/events{/privacy}",
              "received_events_url": "https://api.github.com/users/CartoDB/received_events",
              "type": "Organization",
              "site_admin": false
            },
            "private": false,
            "html_url": "https://github.com/CartoDB/cartodb",
            "description": "Location Intelligence & Data Visualization tool",
            "fork": false,
            "url": "https://api.github.com/repos/CartoDB/cartodb",
            "forks_url": "https://api.github.com/repos/CartoDB/cartodb/forks",
            "keys_url": "https://api.github.com/repos/CartoDB/cartodb/keys{/key_id}",
            "collaborators_url": "https://api.github.com/repos/CartoDB/cartodb/collaborators{/collaborator}",
            "teams_url": "https://api.github.com/repos/CartoDB/cartodb/teams",
            "hooks_url": "https://api.github.com/repos/CartoDB/cartodb/hooks",
            "issue_events_url": "https://api.github.com/repos/CartoDB/cartodb/issues/events{/number}",
            "events_url": "https://api.github.com/repos/CartoDB/cartodb/events",
            "assignees_url": "https://api.github.com/repos/CartoDB/cartodb/assignees{/user}",
            "branches_url": "https://api.github.com/repos/CartoDB/cartodb/branches{/branch}",
            "tags_url": "https://api.github.com/repos/CartoDB/cartodb/tags",
            "blobs_url": "https://api.github.com/repos/CartoDB/cartodb/git/blobs{/sha}",
            "git_tags_url": "https://api.github.com/repos/CartoDB/cartodb/git/tags{/sha}",
            "git_refs_url": "https://api.github.com/repos/CartoDB/cartodb/git/refs{/sha}",
            "trees_url": "https://api.github.com/repos/CartoDB/cartodb/git/trees{/sha}",
            "statuses_url": "https://api.github.com/repos/CartoDB/cartodb/statuses/{sha}",
            "languages_url": "https://api.github.com/repos/CartoDB/cartodb/languages",
            "stargazers_url": "https://api.github.com/repos/CartoDB/cartodb/stargazers",
            "contributors_url": "https://api.github.com/repos/CartoDB/cartodb/contributors",
            "subscribers_url": "https://api.github.com/repos/CartoDB/cartodb/subscribers",
            "subscription_url": "https://api.github.com/repos/CartoDB/cartodb/subscription",
            "commits_url": "https://api.github.com/repos/CartoDB/cartodb/commits{/sha}",
            "git_commits_url": "https://api.github.com/repos/CartoDB/cartodb/git/commits{/sha}",
            "comments_url": "https://api.github.com/repos/CartoDB/cartodb/comments{/number}",
            "issue_comment_url": "https://api.github.com/repos/CartoDB/cartodb/issues/comments{/number}",
            "contents_url": "https://api.github.com/repos/CartoDB/cartodb/contents/{+path}",
            "compare_url": "https://api.github.com/repos/CartoDB/cartodb/compare/{base}...{head}",
            "merges_url": "https://api.github.com/repos/CartoDB/cartodb/merges",
            "archive_url": "https://api.github.com/repos/CartoDB/cartodb/{archive_format}{/ref}",
            "downloads_url": "https://api.github.com/repos/CartoDB/cartodb/downloads",
            "issues_url": "https://api.github.com/repos/CartoDB/cartodb/issues{/number}",
            "pulls_url": "https://api.github.com/repos/CartoDB/cartodb/pulls{/number}",
            "milestones_url": "https://api.github.com/repos/CartoDB/cartodb/milestones{/number}",
            "notifications_url": "https://api.github.com/repos/CartoDB/cartodb/notifications{?since,all,participating}",
            "labels_url": "https://api.github.com/repos/CartoDB/cartodb/labels{/name}",
            "releases_url": "https://api.github.com/repos/CartoDB/cartodb/releases{/id}",
            "deployments_url": "https://api.github.com/repos/CartoDB/cartodb/deployments",
            "created_at": "2012-07-05T15:23:45Z",
            "updated_at": "2016-08-08T21:52:25Z",
            "pushed_at": "2016-08-09T15:44:07Z",
            "git_url": "git://github.com/CartoDB/cartodb.git",
            "ssh_url": "git@github.com:CartoDB/cartodb.git",
            "clone_url": "https://github.com/CartoDB/cartodb.git",
            "svn_url": "https://github.com/CartoDB/cartodb",
            "homepage": "http://carto.com",
            "size": 398205,
            "stargazers_count": 1220,
            "watchers_count": 1220,
            "language": "HTML",
            "has_issues": true,
            "has_downloads": true,
            "has_wiki": true,
            "has_pages": false,
            "forks_count": 308,
            "mirror_url": null,
            "open_issues_count": 1067,
            "forks": 308,
            "open_issues": 1067,
            "watchers": 1220,
            "default_branch": "master"
          }
        },
        "_links": {
          "self": {
            "href": "https://api.github.com/repos/CartoDB/cartodb/pulls/9374"
          },
          "html": {
            "href": "https://github.com/CartoDB/cartodb/pull/9374"
          },
          "issue": {
            "href": "https://api.github.com/repos/CartoDB/cartodb/issues/9374"
          },
          "comments": {
            "href": "https://api.github.com/repos/CartoDB/cartodb/issues/9374/comments"
          },
          "review_comments": {
            "href": "https://api.github.com/repos/CartoDB/cartodb/pulls/9374/comments"
          },
          "review_comment": {
            "href": "https://api.github.com/repos/CartoDB/cartodb/pulls/comments{/number}"
          },
          "commits": {
            "href": "https://api.github.com/repos/CartoDB/cartodb/pulls/9374/commits"
          },
          "statuses": {
            "href": "https://api.github.com/repos/CartoDB/cartodb/statuses/1921e7557180608528274dfca31ce6ef967f00ca"
          }
        }
      }
    },
    "public": true,
    "created_at": "2016-08-09T16:26:56Z",
    "org": {
      "id": 1799254,
      "login": "CartoDB",
      "gravatar_id": "",
      "url": "https://api.github.com/orgs/CartoDB",
      "avatar_url": "https://avatars.githubusercontent.com/u/1799254?"
    }
  }
